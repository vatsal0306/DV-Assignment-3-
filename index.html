<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Author Network Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .node {
            stroke: #fff;
            stroke-width: 1.5px;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
        }
        .tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            padding: 5px;
            font-size: 12px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="controls">
        <label for="charge">Charge Strength: </label>
        <input type="range" id="charge" min="-100" max="100" value="-30">
        <label for="collide">Collision Radius: </label>
        <input type="range" id="collide" min="0" max="20" value="12">
        <label for="linkStrength">Link Strength: </label>
        <input type="range" id="linkStrength" min="0" max="2" step="0.1" value="1">
    </div>

    <div id="tooltip" class="tooltip" style="display: none;"></div>
    <svg width="960" height="600"></svg>

    <script>
        // Load data (replace 'data.json' with your actual data source)
        d3.json('data.json').then(function(data) {
            const width = 960;
            const height = 600;
            const svg = d3.select("svg");

            // Tooltip setup
            const tooltip = d3.select("#tooltip");

            // Define color scale for top 10 countries + others
            const countries = Array.from(new Set(data.nodes.map(d => d.country))).slice(0, 10);
            const color = d3.scaleOrdinal()
                .domain(countries)
                .range(d3.schemeCategory10)
                .unknown("#A9A9A9");

            // Node sizing based on degree
            const nodeSize = d3.scaleSqrt()
                .domain(d3.extent(data.nodes, d => d.degree))
                .range([3, 12]);

            // Set up the simulation
            const simulation = d3.forceSimulation(data.nodes)
                .force("link", d3.forceLink(data.links).id(d => d.id).strength(1))
                .force("charge", d3.forceManyBody().strength(-30))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collide", d3.forceCollide().radius(d => nodeSize(d.degree) + 2));

            // Draw links
            const link = svg.append("g")
                .attr("class", "links")
                .selectAll("line")
                .data(data.links)
                .enter().append("line")
                .attr("class", "link")
                .style("stroke-width", 1);

            // Draw nodes
            const node = svg.append("g")
                .attr("class", "nodes")
                .selectAll("circle")
                .data(data.nodes)
                .enter().append("circle")
                .attr("class", "node")
                .attr("r", d => nodeSize(d.degree))
                .attr("fill", d => color(d.country))
                .on("mouseover", function(event, d) {
                    node.style("opacity", o => o.country === d.country ? 1 : 0.2);
                    link.style("opacity", 0.2);
                    tooltip.style("display", "block")
                        .html(`<strong>Author:</strong> ${d.name}<br><strong>Country:</strong> ${d.country}`)
                        .style("left", `${event.pageX + 5}px`)
                        .style("top", `${event.pageY + 5}px`);
                })
                .on("mousemove", function(event) {
                    tooltip.style("left", `${event.pageX + 5}px`).style("top", `${event.pageY + 5}px`);
                })
                .on("mouseleave", function() {
                    node.style("opacity", 1);
                    link.style("opacity", 1);
                    tooltip.style("display", "none");
                });

            simulation.on("tick", () => {
                link.attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node.attr("cx", d => d.x)
                    .attr("cy", d => d.y);
            });

            // UI controls
            d3.select("#charge").on("input", function() {
                simulation.force("charge").strength(-this.value).restart();
            });
            d3.select("#collide").on("input", function() {
                simulation.force("collide").radius(+this.value).restart();
            });
            d3.select("#linkStrength").on("input", function() {
                simulation.force("link").strength(+this.value).restart();
            });
        });
    </script>
</body>
</html>
